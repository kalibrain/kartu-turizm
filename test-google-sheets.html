<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets Test - Kartu Turizm</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="alternate icon" href="favicon.ico">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .test-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .test-button:hover {
            background-color: #0056b3;
        }
        .test-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Google Sheets API Test</h1>
        <p>Bu sayfa Google Sheets entegrasyonunu test etmek iÃ§in hazÄ±rlanmÄ±ÅŸtÄ±r.</p>
        
        <div class="test-section">
            <h3>ğŸ¯ Test FonksiyonlarÄ±:</h3>
            <button class="test-button" onclick="testBasicConnection()">1. Temel BaÄŸlantÄ± Testi</button>
            <button class="test-button" onclick="testSimpleData()">2. Basit Veri GÃ¶nderimi</button>
            <button class="test-button" onclick="testFullFormData()">3. Tam Form Verisi</button>
            <button class="test-button" onclick="testCORSSettings()">4. CORS AyarlarÄ± Testi</button>
            <button class="test-button" onclick="clearResults()">âŒ SonuÃ§larÄ± Temizle</button>
        </div>

        <div id="results"></div>

        <div class="instructions">
            <h3>ğŸ“‹ OlasÄ± Ã‡Ã¶zÃ¼mler:</h3>
            <ol>
                <li><strong>Google Apps Script Permissions:</strong> Script'inizi yeniden deploy edin ve "Execute as: Me" ve "Who has access: Anyone" olarak ayarlayÄ±n</li>
                <li><strong>Trigger Function:</strong> doPost fonksiyonunun doÄŸru Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan emin olun</li>
                <li><strong>Sheet Permissions:</strong> Google Sheet'inizin herkes tarafÄ±ndan dÃ¼zenlenebilir olduÄŸundan emin olun</li>
                <li><strong>Script URL:</strong> En son deployment URL'sini kullandÄ±ÄŸÄ±nÄ±zdan emin olun</li>
            </ol>
        </div>
    </div>

    <script>
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx11BpTsBDx3pNPvhviiF08gLNsQ9rVgyOQf9FpiqhuEctOrB-Se0uB0I8lT1UDvcNFHg/exec';

        function logResult(message, type = 'info') {
            const results = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(resultDiv);
            results.scrollTop = results.scrollHeight;
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        async function testBasicConnection() {
            logResult('ğŸ”„ Temel baÄŸlantÄ± testi baÅŸlatÄ±lÄ±yor...', 'info');
            
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'GET',
                    mode: 'no-cors'
                });
                
                logResult('âœ… GET isteÄŸi gÃ¶nderildi (no-cors mode)', 'success');
                logResult('âš ï¸  no-cors mode kullanÄ±ldÄ±ÄŸÄ± iÃ§in response okunamÄ±yor', 'info');
                
            } catch (error) {
                logResult(`âŒ BaÄŸlantÄ± hatasÄ±: ${error.message}`, 'error');
            }
        }

        async function testSimpleData() {
            logResult('ğŸ”„ Basit veri gÃ¶nderimi testi baÅŸlatÄ±lÄ±yor...', 'info');
            
            const testData = {
                test: true,
                message: 'Test verisi',
                timestamp: new Date().toISOString()
            };

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData),
                    mode: 'no-cors'
                });
                
                logResult('âœ… POST isteÄŸi gÃ¶nderildi (basit veri)', 'success');
                logResult(`ğŸ“¤ GÃ¶nderilen veri: ${JSON.stringify(testData, null, 2)}`, 'info');
                
            } catch (error) {
                logResult(`âŒ Veri gÃ¶nderimi hatasÄ±: ${error.message}`, 'error');
            }
        }

        async function testFullFormData() {
            logResult('ğŸ”„ Tam form verisi testi baÅŸlatÄ±lÄ±yor...', 'info');
            
            const fullTestData = {
                studentName: 'Test Ã–ÄŸrenci',
                studentGrade: '1',
                studentBranch: 'A',
                schoolAddress: 'Åehit Ender Alper Ä°lkokulu',
                mainAddress: 'Test Mahallesi Test Sokak No:1',
                buildingName: 'Test ApartmanÄ±',
                apartmentNumber: 'Daire 1',
                addressNotes: 'Test adres notu',
                fullAddress: 'Test Mahallesi Test Sokak No:1, Test ApartmanÄ± Daire 1',
                coordinates: { lat: 39.9208, lng: 32.8541 },
                motherName: 'Test Anne',
                motherPhone: '555 123 45 67',
                motherEmail: 'test@anne.com',
                fatherName: 'Test Baba',
                fatherPhone: '555 987 65 43',
                fatherEmail: 'test@baba.com',
                additionalMessage: 'Test ek mesaj',
                estimatedPrice: '3500 TL'
            };

            try {
                // Try with CORS first to get debug response
                let responseData = null;
                
                try {
                    logResult('ğŸ”„ CORS mode ile deneniyor (debug bilgisi almak iÃ§in)...', 'info');
                    const response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(fullTestData),
                        mode: 'cors'
                    });
                    responseData = await response.json();
                    logResult('âœ… CORS baÅŸarÄ±lÄ± - debug bilgisi alÄ±ndÄ±!', 'success');
                } catch (corsError) {
                    logResult('âš ï¸ CORS baÅŸarÄ±sÄ±z, no-cors ile devam ediliyor...', 'info');
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(fullTestData),
                        mode: 'no-cors'
                    });
                }
                
                logResult('âœ… POST isteÄŸi gÃ¶nderildi (tam form verisi)', 'success');
                
                if (responseData && responseData.debug) {
                    const debug = responseData.debug;
                    logResult('ğŸ” DEBUG BÄ°LGÄ°LERÄ°:', 'info');
                    logResult(`ğŸ“Š Sheet: ${debug.sheetName}`, 'info');
                    logResult(`ğŸ“ Hedef satÄ±r: ${debug.targetRow}`, 'info');
                    logResult(`ğŸ“‹ Son veri satÄ±rÄ±: ${debug.lastRowWithData}`, 'info');
                    logResult(`ğŸ“ Row uzunluÄŸu: ${debug.rowLength} (beklenen: ${debug.expectedColumns})`, 'info');
                    logResult(`ğŸ—ºï¸ Koordinatlar var mÄ±: ${debug.coordinatesExists}`, 'info');
                    logResult(`ğŸ“ Koordinat metni: "${debug.coordinatesText}"`, 'info');
                    logResult(`ğŸ‘© Anne adÄ±: "${debug.motherName}"`, 'info');
                    
                    if (debug.fullRowData) {
                        logResult('ğŸ“‹ SÃœTUN VERÄ°LERÄ°:', 'info');
                        logResult(`[10] Koordinatlar: "${debug.fullRowData[10]}"`, 'info');
                        logResult(`[11] Harita Linki: "${debug.fullRowData[11]}"`, 'info');
                        logResult(`[12] Anne AdÄ±: "${debug.fullRowData[12]}"`, 'info');
                    }
                } else {
                    logResult('ğŸ“‹ Google Sheet\'inizi kontrol edin - yeni bir satÄ±r eklenmiÅŸ olmalÄ±', 'success');
                    logResult('ğŸ“ Koordinatlar sÃ¼tununda lat, lng deÄŸerleri gÃ¶rÃ¼nmelidir', 'info');
                    logResult('âœ… Harita linki kaldÄ±rÄ±ldÄ± - sadece koordinatlar var', 'info');
                }
                
            } catch (error) {
                logResult(`âŒ Tam veri gÃ¶nderimi hatasÄ±: ${error.message}`, 'error');
            }
        }

        async function testCORSSettings() {
            logResult('ğŸ”„ CORS ayarlarÄ± testi baÅŸlatÄ±lÄ±yor...', 'info');
            
            // Test 1: Normal CORS mode
            try {
                logResult('Test 1: Normal CORS mode...', 'info');
                const response1 = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ test: 'cors-test' }),
                    mode: 'cors'
                });
                
                const result = await response1.text();
                logResult(`âœ… CORS mode baÅŸarÄ±lÄ±: ${result}`, 'success');
                
            } catch (error) {
                logResult(`âŒ CORS mode hatasÄ±: ${error.message}`, 'error');
                
                // Test 2: no-cors mode fallback
                try {
                    logResult('Test 2: no-cors mode fallback...', 'info');
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ test: 'no-cors-test' }),
                        mode: 'no-cors'
                    });
                    
                    logResult('âœ… no-cors mode Ã§alÄ±ÅŸÄ±yor', 'success');
                    
                } catch (error2) {
                    logResult(`âŒ no-cors mode da hatasÄ±: ${error2.message}`, 'error');
                }
            }
        }

        // Auto-test on page load
        window.addEventListener('load', () => {
            logResult('ğŸš€ Test sayfasÄ± yÃ¼klendi. URL: ' + GOOGLE_SCRIPT_URL, 'info');
            logResult('ğŸ‘† Testleri baÅŸlatmak iÃ§in yukarÄ±daki butonlara tÄ±klayÄ±n', 'info');
        });
    </script>
</body>
</html> 